<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#007bff">
    <meta name="description" content="SDK Muta - Kalkulator Tournament Scoring Application">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="img/logo.svg">
    <link rel="apple-touch-icon" href="img/logo.png">
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <title>SDK Muta - Kalkulator</title>
</head>
<body>
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="confirmation-modal">
        <div class="confirmation-modal-content">
            <div class="confirmation-modal-title" id="confirmation-modal-title">Confirm Deletion</div>
            <div class="confirmation-modal-message" id="confirmation-modal-message">Are you sure you want to delete this item?</div>
            <div class="confirmation-modal-buttons">
                <button class="btn-cancel" onclick="closeConfirmationModal()" data-i18n="confirmation.cancel">Cancel</button>
                <button class="btn-delete" onclick="confirmAction()" data-i18n="confirmation.delete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo-title">
                <div class="nav-logo">
                    <img src="img/logo-header.svg" alt="SDK Muta Logo" style="width: 48px; height: 48px;">
                </div>
                <h1 class="nav-title" id="navbar-title">SDK Muta - Kalkulator</h1>
            </div>
            <div class="nav-right">
                <button class="help-btn" id="help-toggle-btn" onclick="toggleInstructions()" title="Show/Hide Instructions" style="display: none;">?</button>
                <button class="lang-btn" onclick="changeLanguage('en')">EN</button>
                <button class="lang-btn active" onclick="changeLanguage('sl')">SL</button>
            </div>
        </div>
    </nav>

    <!-- Main Application Container -->
    <div class="app-container">
        <!-- View 1: Participant Selection -->
        <div id="view-participants" class="view active">
            <div class="instructions-panel" id="instructions-participants">
                <h3>üìã <span data-i18n="instructions.title">Instructions</span></h3>
                <ol>
                    <li><span data-i18n="instructions.search">Search or Add: Type a player name to search existing players or add new ones</span></li>
                    <li><span data-i18n="instructions.select_all">Select All: Click the ‚úì button to select/deselect all visible players</span></li>
                    <li><span data-i18n="instructions.add_button">Add: Type a name and press Enter or wait for the Add button to appear</span></li>
                    <li><span data-i18n="instructions.select">Select Players: Click on player cards to select/deselect them</span></li>
                    <li><span data-i18n="instructions.delete">Delete: Click the ‚úï button on a player card to remove them</span></li>
                    <li><span data-i18n="instructions.history">History: View your last 5 tournaments in the Tournament History section below</span></li>
                    <li><span data-i18n="instructions.continue">Continue: Once you've selected players, click "Start Match"</span></li>
                </ol>
            </div>

            <h2 data-i18n="players.player_management">Player Management</h2>

            <div class="player-selection-card">
                <label style="font-weight: 600; color: #2c3e50; font-size: 0.95rem; display: block; margin-bottom: 0.5rem;" data-i18n="players.include_participant">Include a participant</label>
                <div class="player-controls">
                    <div class="search-box">
                        <input type="text"
                               id="player-search"
                               placeholder="Search or add player..."
                               data-i18n-placeholder="league.search_players_placeholder"
                               onkeyup="filterPlayers()">
                    </div>
                    <div class="player-controls-buttons">
                        <button class="btn btn-primary" id="toggle-all-btn" onclick="toggleAllPlayersButton()" title="Toggle select all">‚úì</button>
                        <button class="btn btn-primary" id="add-player-btn" data-i18n="players.add_button" disabled>+</button>
                    </div>
                </div>
                <div class="players-list" id="players-list"></div>
            </div>

            <!-- Start Match Button -->
            <div style="margin-top: 1.5rem; display: flex; justify-content: center;">
                <button class="btn btn-danger" onclick="proceedToConfig()" style="background-color: #dc3545; border-color: #dc3545; color: #ffffff; padding: 1rem 2rem; font-size: 1.1rem; font-weight: 600;">
                    <span data-i18n="navigation.start_match">Start Match</span>
                </button>
            </div>

            <!-- Tournament History Section -->
            <div class="history-card">
                <button class="collapsible-header collapsed" onclick="toggleCollapsible(this)">
                    <span class="collapsible-icon">‚ñº</span>
                    <h3 style="font-size: 1.4rem; margin: 0; color: #2c3e50; display: inline;" data-i18n="results.history_title">Tournament History</h3>
                    <span class="collapsible-counter" id="history-counter" style="font-size: 0.9rem; color: #999;">(0/5)</span>
                </button>
                <div class="collapsible-content collapsed" id="participants-history-container">
                    <div class="history-container">
                        <div class="history-empty" id="participants-history-empty">
                            <p data-i18n="results.no_history">No tournaments yet. Start a tournament to build history!</p>
                        </div>
                        <div class="history-list" id="participants-history-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- View 2: Tournament Configuration -->
        <div id="view-config" class="view">
            <h2 data-i18n="tournament.tournament_setup">Tournament Setup</h2>

            <div class="instructions-panel" id="instructions-config">
                <h3>üìã <span data-i18n="instructions.title">Instructions</span></h3>
                <ol>
                    <li><span data-i18n="instructions.targets">Number of Targets: How many targets will each player shoot at?</span></li>
                    <li><span data-i18n="instructions.bullets">Bullets per Target: How many bullets/shots per target?</span></li>
                    <li><span data-i18n="instructions.total">Total Shots: Automatically calculated (Targets √ó Bullets)</span></li>
                    <li><span data-i18n="instructions.example">Example: 20 targets √ó 2 bullets = 40 total shots</span></li>
                    <li><span data-i18n="instructions.config_continue">Continue: Click "Next" to start entering scores</span></li>
                </ol>
            </div>

            <div class="config-section">
                <div style="margin-bottom: 1.5rem;">
                    <div class="input-field">
                        <label style="font-weight: 600; color: #2c3e50; font-size: 0.95rem;" data-i18n="tournament.targets">Number of Targets:</label>
                        <input type="number"
                               id="targets-input"
                               value="20"
                               min="1"
                               max="100"
                               onchange="updateTotalShots()"
                               onkeyup="updateTotalShots()"
                               style="padding: 0.8rem; font-size: 1rem; border: 2px solid #e9ecef; border-radius: 8px; text-align: center; transition: all 0.2s ease; width: 100%;">
                    </div>
                </div>
                <div>
                    <div class="input-field">
                        <label style="font-weight: 600; color: #2c3e50; font-size: 0.95rem;" data-i18n="tournament.shots_per_target">Shots per Target:</label>
                        <input type="number"
                               id="bullets-per-target"
                               value="2"
                               min="1"
                               max="20"
                               onchange="updateTotalShots()"
                               onkeyup="updateTotalShots()"
                               style="padding: 0.8rem; font-size: 1rem; border: 2px solid #e9ecef; border-radius: 8px; text-align: center; transition: all 0.2s ease; width: 100%;">
                    </div>
                </div>
            </div>

            <div class="summary-box">
                <h3 data-i18n="results.total_shots">Total Shots:</h3>
                <p id="total-shots-display">40</p>
            </div>

            <div class="view-actions">
                <button class="btn btn-danger" onclick="proceedToScoring()" style="background-color: #dc3545; border-color: #dc3545; color: #ffffff;">
                    <span data-i18n="navigation.next">Next
                    </span>
                </button>
                <button class="btn btn-secondary" onclick="goToView('view-participants')">
                    <span data-i18n="navigation.back">Back</span>
                </button>
            </div>
        </div>

        <!-- View 3: Score Entry -->
        <div id="view-scoring" class="view">
            <h2 data-i18n="scoring.enter_scores">Enter Scores</h2>

            <div class="instructions-panel" id="instructions-scoring">
                <h3>üìã <span data-i18n="instructions.title">Instructions</span></h3>
                <ol>
                    <li><span data-i18n="instructions.range">Score Range: Enter scores from 0 to 10</span></li>
                    <li><span data-i18n="instructions.miss">0 = Miss: No points for that shot</span></li>
                    <li><span data-i18n="instructions.regular">1-9 = Regular: Points for partial hits</span></li>
                    <li><span data-i18n="instructions.perfect">10 = Perfect: Perfect shot (highlighted in YELLOW ‚ú®)</span></li>
                    <li><span data-i18n="instructions.auto_cap">Auto-Cap: Values over 10 automatically become 10</span></li>
                    <li><span data-i18n="instructions.real_time">Real-Time Updates: Totals update as you type</span></li>
                    <li><span data-i18n="instructions.auto_save">Auto-Save: All data saves automatically</span></li>
                    <li><span data-i18n="instructions.finish">Finish: Click "Finish Match" when all scores are entered</span></li>
                    <li><span data-i18n="instructions.excel_export">Excel Export: After finishing, download a detailed Excel report with all individual shot scores</span></li>
                </ol>
            </div>

            <div class="scores-container" id="scores-container"></div>

            <div class="view-actions">
                <button class="btn btn-danger" onclick="finishTournament()" style="background-color: #dc3545; border-color: #dc3545; color: #ffffff;">
                    <span data-i18n="scoring.finish_tournament">Finish Match</span>
                </button>
                <button class="btn btn-secondary" onclick="goToView('view-config')">
                    <span data-i18n="navigation.back">Back</span>
                </button>
            </div>
        </div>

        <!-- View 4: Results Display -->
        <div id="view-results" class="view">
            <div class="instructions-panel" id="instructions-results">
                <h3>üìã <span data-i18n="instructions.title">Instructions</span></h3>
                <ol>
                    <li><span data-i18n="instructions.results_overview">Results Overview: View the final rankings and tournament statistics</span></li>
                    <li><span data-i18n="instructions.results_position">Position: Players ranked by total score and number of perfect shots (10s)</span></li>
                    <li><span data-i18n="instructions.results_medals">Medals: Top 3 positions are marked with ü•á ü•à ü•â</span></li>
                    <li><span data-i18n="instructions.results_export_excel">Excel Export: Download detailed scores for all targets and shots in Excel format</span></li>
                    <li><span data-i18n="instructions.results_export_json">JSON Export: Download tournament data in JSON format for archival</span></li>
                    <li><span data-i18n="instructions.results_export_pdf">Print/PDF: Print or save results as PDF for records</span></li>
                    <li><span data-i18n="instructions.results_new_tournament">New Tournament: Click "Back to Start" to begin another tournament</span></li>
                </ol>
            </div>

            <!-- Results Header -->
            <div class="results-header" id="results-header">
                <img src="img/logo.png" alt="Logo" class="header-logo" style="display: none;">
                <div class="results-title">
                    üèÜ <span data-i18n="results.final_results">Final Results</span>
                </div>
                <div class="results-subtitle" data-i18n="results.rankings">Complete Rankings</div>
                <div class="results-meta">
                    <div class="meta-item">
                        <span class="meta-number" id="header-participants">0</span>
                        <span class="meta-label" data-i18n="tournament.participants">Participants</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-number" id="header-configuration">
                            <span id="header-targets">0</span> T /
                            <span id="header-shots">0</span> S
                        </span>
                        <span class="meta-label" data-i18n="results.tournament_configuration">Tournament Config</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-number" id="header-highest-score">0</span>
                        <span class="meta-label" data-i18n="results.highest_score">Highest Score</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-number" id="header-most-tens">0</span>
                        <span class="meta-label" data-i18n="results.most_tens">Most 10s</span>
                    </div>
                </div>
            </div>

            <!-- Results Table -->
            <div class="results-table-container">
                <table class="results-table" id="results-table"></table>
            </div>

            <div class="results-actions">
                <button class="btn btn-info" onclick="downloadExcel()">
                    üìä <span data-i18n="results.export_excel">Download Excel</span>
                </button>
                <button class="btn btn-info" onclick="downloadJSON()">
                    üìÑ <span data-i18n="results.export_json">Download JSON</span>
                </button>
                <button class="btn btn-info" onclick="downloadPDF()">
                    üñ®Ô∏è <span data-i18n="results.export_pdf">Print/PDF</span>
                </button>
                <button class="btn btn-secondary" onclick="startNewTournament()">
                    <span data-i18n="navigation.back">Back to Start</span>
                </button>
            </div>
        </div>

        <!-- View 5: Tournament History -->
        <div id="view-history" class="view">
            <h2 data-i18n="results.history_title">Tournament History</h2>

            <div class="history-container" id="history-container">
                <div class="history-empty" id="history-empty">
                    <p data-i18n="results.no_history">No tournaments yet. Start a tournament to build history!</p>
                </div>
                <div class="history-list" id="history-list"></div>
            </div>

            <div class="view-actions">
                <div></div>
                <button class="btn btn-secondary" onclick="startNewTournament()">
                    <span data-i18n="navigation.back">Back to Start</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Application Scripts -->
    <!-- Load translations and shared utilities first -->
    <script src="js/translations.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/helpers.js"></script>

    <!-- Load feature modules -->
    <script src="js/modules/players.js"></script>
    <script src="js/modules/config.js"></script>
    <script src="js/modules/scoring.js"></script>
    <script src="js/modules/results.js"></script>

    <!-- Initialize app last -->
    <script src="js/app.js"></script>

    <script>
        // Placeholder for any additional inline scripts if needed in the future
        // The main application logic is now split into modular files
    </script>
</body>
</html>
